<html>
<head>
    <title>Plugins</title>
</head>
<body>
    <script id="template-plugin" type="text/x-template">
        <div>
            <div v-for="item in data">
                <p>{{item.name}}</p>
                <p>{{item.description}}</p>
                <button v-if="!item.progress && !item.enabled && item.installed">Activate</button>
                <button v-if="!item.progress && item.enabled && item.installed">Deactivate</button>
                <button v-if="!item.progress && !item.installed" v-on:click="install(item)">Install</button>
                <button disabled v-if="item.progress">Action in Progress</button>
            </div>
        </div>
    </script>
    <div id="root">
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.5.16/vue.min.js" integrity="sha256-TaLceMwjWRqe4yhbqPOJH6V7UGt5AvvdNfpaIXJWbFU=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
    <script>
        function rpc(package, rpcName, api, args, kwargs) {
            return $.ajax({
                url: "/api/rpc",
                type: 'post',
                contentType: 'application/json; charset=UTF-8',
                data: JSON.stringify({
                    package_name: package,
                    rpc_name: rpcName,
                    api_name: api,
                    args: args,
                    kwargs: kwargs
                })
            });
        }
        function install(plugin) {
            return rpc("weaveserver.services.plugins", "plugins", "install_plugin", ["git", plugin.url], {});
        }

        $(document).ready(function() {
            rpc("weaveserver.services.plugins", "plugins", "list_available", [], {}).then(function(data) {
                var app = new Vue({
                    el: '#root',
                    template: '#template-plugin',
                    data: {data: data}
                })
            });
        });
    </script>
</body>
</html>