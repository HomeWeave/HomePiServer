<html>
<head>
    <title>Plugins</title>
</head>
<body>
    <script type="text/x-template" id="template-ui-components">
        <!-- TODO: Remove one level of hierarchy of div -->
        <div v-if="data.type == 'vertical-layout'">
            <vertical-layout v-bind:data="data"></vertical-layout>
        </div>
        <div v-else-if="data.type == 'h3'">
            <header-3 v-bind:data="data.text"></header-3>
        </div>
        <div v-else-if="data.type == 'paragraph'">
            <paragraph v-bind:data="data.text"></paragraph>
        </div>
        <div v-else-if="data.type == 'button'">
            <weave-button v-bind:data="data"></weave-button>
        </div>
    </script>
    <script type="text/x-template" id="template-vertical-layout">
        <div>
            <div class="row" v-for="item in data.items">
                <div v-bind:class="'col-lg-' + data.columnsLarge + ' col-md-' + data.columnsMedium + ' col-sm-' + data.columnsSmall">
                    <all-components v-bind:data="item"></all-components>
                </div>
            </div>
        <div>
    </script>
    <script type="text/x-template" id="template-paragraph">
        <p>{{$root.processUITemplate(data)}}</p>
    </script>
    <script type="text/x-template" id="template-h3">
        <h3>{{data}}</h3>
    </script>
    <script type="text/x-template" id="template-button">
        <button v-on:click="$root.fireEvent(data.onclick)">
            {{data.text}}
        </button>
    </script>
    <div id="root">
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.5.16/vue.min.js" integrity="sha256-TaLceMwjWRqe4yhbqPOJH6V7UGt5AvvdNfpaIXJWbFU=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.10/lodash.core.min.js" integrity="sha256-Q+4FYyw42bZJQS9v3+BXNtPLNxKqDLKIEPt50Z4fiYw=" crossorigin="anonymous"></script>
    <script src="/static/js/weave.js"></script>
    <script>
        var app = {
            "$variables": {},
            "$actions": {
                "$load": [
                    {
                        "type": "$rpc",
                        "data": {
                            "package_name": "weaveserver.services.updater",
                            "rpc_name": "system",
                            "api_name": "status"
                        },
                        "success": [
                            {
                                "type": "$store",
                                "keys": ["variables", "status"],
                                "value": {
                                    "__vartype": "result",
                                    "__expression": {
                                        "keys": [0]
                                    }
                                }
                            }
                        ]
                    }
                ],
                "check_updates": [
                    {
                        "type": "$rpc",
                        "data": {
                            "package_name": "weaveserver.services.updater",
                            "rpc_name": "system",
                            "api_name": "check_updates"
                        }
                    }
                ],
                "upgrade": [
                    {
                        "type": "$rpc",
                        "data": {
                            "package_name": "weaveserver.services.updater",
                            "rpc_name": "system",
                            "api_name": "perform_upgrade"
                        }
                    }
                ],
                "reboot": [
                    {
                        "type": "$rpc",
                        "data": {
                            "package_name": "weaveserver.services.updater",
                            "rpc_name": "system",
                            "api_name": "reboot"
                        }
                    }
                ]
            },
            "$ui": {
                "type": "vertical-layout",
                "columnsLarge": 12,
                "columnsMedium": 12,
                "columnsSmall": 12,
                "items": [
                    {
                        "type": "h3",
                        "text": "System Update Status"
                    },
                    {
                        "type": "paragraph",
                        "text": {
                            "__vartype": "variables",
                            "__expression": {
                                "keys": ["status"]
                            }
                        }
                    },
                    {
                        "type": "button",
                        "text": "Check For Updates",
                        "onclick": [
                            {
                                "type": "$action",
                                "action": "check_updates",
                                "data": []
                            }
                        ]
                    },
                    {
                        "type": "condition",
                        "op": "eq",
                        "operands": [
                            {
                                "__vartype": "variables",
                                "__expression": {
                                    "keys": ["status"]
                                }
                            },
                            "Updates available."
                        ],
                        "value": {
                            "type": "button",
                            "text": "Upgrade",
                            "onclick": [
                                {
                                    "type": "$action",
                                    "action": "upgrade",
                                    "data": []
                                }
                            ]
                        }
                    },
                    {
                        "type": "button",
                        "text": "Reboot",
                        "onclick": [
                            {
                                "type": "$action",
                                "action": "reboot",
                                "data": []
                            }
                        ]
                    },
                ]
            }
        };

        $(document).ready(function() {
            registerComponent('vertical-layout', '#template-vertical-layout');
            registerComponent('header-3', '#template-h3');
            registerComponent('paragraph', '#template-paragraph');
            registerComponent('weave-button', '#template-button');
            var application = GenericApplication("#root", app);
        });
    </script>
</body>
</html>