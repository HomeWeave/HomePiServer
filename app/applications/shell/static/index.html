<html>
<head>
	<style>
	#page-wrapper {
		flex-direction: column;
	}

	.qr-row {
		margin: 25px;
	}

	.app-tile-border {
		position: absolute;
		border-color: white;
		border-style: 5px solid;
		border-radius: 5px;
		background-color: rgba(0, 0, 0, 0);
		z-index: 200;
	}

	#qrcode {
		margin-right: 15px;
		width: 150px;
		height: 150px;
	}
	</style>
</head>

<body>
	<div id="page-wrapper">
		<div class="col-lg-12" id="tiles">
			<div style="text-align: center">
			<i class="fa fa-circle-o-notch fa-spin fa-3x"></i>
			</div>
		</div>
		
		<div class="col-lg-12">
			<div class="col-lg-4 pull-right">
				<div class="pull-right" id="qrcode"></div>
				<h3></h3>
			</div>
		</div>
	</div>


	<div style="display:none" id="tile-template">
		<div id="selected-box" class="app-tile-border">
			
		</div>
		<div class="col-lg-12 col-md-12 col-sm-3">
		{{#tiles}}
			<div class="col-lg-3 col-md-3 col-sm-3 app-tile" data-appid="{{id}}" style="padding: 10px">
				<div style="font-size: 30px; padding:20px 10px 20px 10px" class="pull-left">
					<i class="fa {{icon}}" />
				</div>
				<div class="pull-left">
					<h2 style="margin-top: 5px; margin-bottom: 2px">{{name}}</h2>
					{{description}}
				</div>
			</div>
		{{/tiles}}
		</div>
	</div>

	<script src="https://code.jquery.com/jquery-1.9.1.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.qrcode/1.0/jquery.qrcode.min.js"></script>
	<script type="text/javascript">
	var movement = (function() {
		var highlight = function(elem) {
			var box = $("#selected-box");
			var margin = -5;
			var rect = elem[0].getBoundingClientRect();
			box.animate({
				left: rect.left,
				top: rect.top,
				width: rect.right - rect.left,
				height: rect.bottom - rect.top,
			}, 200);
		}

		function findAppElem(appId) {
			var selector = '.app-tile[data-appid~="' + appId + '"]';
			return $(selector);
		}

		return {
			init: function() {
				
			},
			move: function(appId) {
				var elem = findAppElem(appId);
				if (elem.length == 0) {
					return;
				}
				highlight(elem);
			}
		}
	})();


	$(document).ready(function() {
		var templateHTML = $('#tile-template').html();
		var socket = Socket({
			listeners: {
				"apps": function (data) {
					var compiled = template(templateHTML);
					var html = compiled(data);

					var wrapper = $("#tiles");
					wrapper.hide();
					wrapper.html(html);
					wrapper.fadeIn();

					$('#qrcode').qrcode({
						text: data.piremote,
						height: 150,
						width: 150
					});
					$("#qrcode ~ h3").html("Scan QR code to download the remote control app on your Android phone");
				},
				"selected": function (data) {
					movement.move(data.appId);
				}
			},
			initMsg: 'get_apps'
		});
	});
	</script>
</body>
</html>